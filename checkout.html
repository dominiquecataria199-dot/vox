<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Terminal de Règlement | VOX MASTERY</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Manrope:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- SDK PAIEMENTS -->
    <script src="https://www.paypal.com/sdk/js?client-id=AYdbiOBrS1LfLCWhleavJP0U94wSEARnYj_HO-VGRCqDeMIh2HDDupr6ll4qfiZBXxxjYg8ioIkKEyqb&currency=USD"></script>
    <script src="https://cdn.fedapay.com/checkout.js?v=1.1.7"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { heading: ['Bebas Neue', 'sans-serif'], body: ['Manrope', 'sans-serif'] },
                    colors: { void: '#0A0A0A', paper: '#111111', neon: '#6366f1', accent: '#a855f7' }
                }
            }
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        .method-card { transition: all 0.3s ease; border: 1px solid #f3f4f6; }
        .method-card.selected { border-color: #6366f1; background: rgba(99, 102, 241, 0.05); }
        html, body { height: 100%; overflow-x: hidden; }
    </style>
</head>

<body class="bg-void text-gray-200 font-body antialiased min-h-screen flex flex-col" x-data="paymentSystem()">

    <!-- HEADER -->
    <header class="py-6 px-8 flex justify-between items-center bg-void">
        <div class="font-heading text-2xl tracking-[0.2em] text-white">VOX MASTERY</div>
        <div class="flex items-center gap-2 text-[10px] text-neon font-mono uppercase border border-neon/30 px-3 py-1 rounded-full">
            <span class="w-1.5 h-1.5 bg-neon rounded-full animate-pulse"></span> Terminal Sécurisé
        </div>
    </header>

    <!-- MAIN CONTAINER CENTRÉ -->
    <main class="flex-grow flex items-center justify-center p-4 md:p-8">
        
        <!-- BLOC UNIQUE FUSIONNÉ -->
        <div class="max-w-6xl w-full grid grid-cols-1 lg:grid-cols-12 overflow-hidden rounded-2xl shadow-[0_30px_100px_rgba(0,0,0,0.5)] border border-white/5">
            
            <!-- GAUCHE : RÉCAPITULATIF (FOND NOIR) -->
            <div class="lg:col-span-5 bg-paper p-8 md:p-12 flex flex-col justify-center border-r border-white/5">
                <div class="inline-block px-3 py-1 rounded-full bg-neon/10 border border-neon/20 text-neon text-[10px] font-mono uppercase tracking-widest mb-6">Récapitulatif</div>
                
                <h2 class="font-heading text-4xl text-white mb-8 tracking-tight uppercase">Votre Admission</h2>
                
                <div class="space-y-8">
                    <div class="flex gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-white/5 flex items-center justify-center text-neon">
                            <i class="fa-solid fa-award"></i>
                        </div>
                        <div>
                            <h3 class="text-white font-bold text-sm">Programme Mentoring 2026</h3>
                            <p class="text-gray-500 text-xs mt-1">Accès complet 12 semaines • Coaching Individuel</p>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-white/5 flex items-center justify-center text-neon">
                            <i class="fa-solid fa-fingerprint"></i>
                        </div>
                        <div>
                            <h3 class="text-white font-bold text-sm">Analyse VPA & Diagnostic</h3>
                            <p class="text-gray-500 text-xs mt-1">Données biométriques traitées</p>
                        </div>
                    </div>

                    <!-- BLOC PRIX DANS LA CARTE -->
                    <div class="bg-void/50 p-6 rounded-xl border border-white/5 mt-10">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-500 text-[10px] uppercase font-bold tracking-widest">Investissement Total</span>
                            <span class="text-green-500 text-[10px] font-mono uppercase">Sécurisé</span>
                        </div>
                        <div class="flex items-baseline gap-2">
                            <span class="text-white font-heading text-5xl">850.000</span>
                            <span class="text-gray-400 font-heading text-2xl">FCFA</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DROITE : TERMINAL (FOND BLANC) -->
            <div class="lg:col-span-7 bg-white p-8 md:p-12 flex flex-col justify-center">
                <div class="max-w-md mx-auto w-full text-void">
                    <div class="text-center mb-10">
                        <h3 class="font-heading text-3xl mb-2 uppercase tracking-tight">Règlement sécurisé</h3>
                        <p class="text-gray-400 text-sm">Sélectionnez votre mode de paiement</p>
                    </div>

                    <!-- MÉTHODES -->
                    <div class="grid grid-cols-2 gap-4 mb-8">
                        <div @click="gateway = 'fedapay'" 
                             :class="gateway === 'fedapay' ? 'selected' : ''" 
                             class="method-card p-6 rounded-xl flex flex-col items-center text-center cursor-pointer group">
                            <i class="fa-solid fa-mobile-screen-button text-2xl text-gray-700 mb-3"></i>
                            <span class="text-[10px] font-bold uppercase">Local</span>
                            <span class="text-[8px] text-gray-400 uppercase">Africa / Momo</span>
                        </div>

                        <div @click="gateway = 'paypal'" 
                             :class="gateway === 'paypal' ? 'selected' : ''" 
                             class="method-card p-6 rounded-xl flex flex-col items-center text-center cursor-pointer group">
                            <i class="fa-brands fa-paypal text-2xl text-blue-700 mb-3"></i>
                            <span class="text-[10px] font-bold uppercase">International</span>
                            <span class="text-[8px] text-gray-400 uppercase">PayPal / Card</span>
                        </div>
                    </div>

                    <!-- INFO DOSSIER -->
                    <div class="mb-8 p-4 bg-gray-50 rounded-xl border border-gray-100 flex items-center gap-4">
                        <i class="fa-solid fa-user-shield text-neon"></i>
                        <div class="overflow-hidden">
                            <p class="text-[8px] uppercase text-gray-400 font-bold">Dossier Client</p>
                            <p class="text-sm font-bold font-mono truncate" x-text="email"></p>
                        </div>
                    </div>

                    <!-- ACTIONS -->
                    <div id="paypal-button-container" x-show="gateway === 'paypal'" class="animate-fadeIn mb-4"></div>
                    
                    <button x-show="gateway === 'fedapay'" @click="payWithFeda()" 
                        class="w-full bg-void text-white py-5 rounded-xl font-bold uppercase tracking-[0.2em] text-sm hover:bg-neon transition-all shadow-xl flex justify-center items-center gap-3">
                        <span x-show="!loading">Valider l'adhésion</span>
                        <span x-show="loading"><i class="fa-solid fa-circle-notch fa-spin"></i> Traitement...</span>
                    </button>

                    <p class="text-center text-[9px] text-gray-400 mt-8 uppercase tracking-[0.3em] font-bold">
                        <i class="fa-solid fa-lock text-green-500 mr-2"></i> Certifié PCI-DSS 
                    </p>
                </div>
            </div>
        </div>
    </main>

    <!-- SUCCESS MODAL -->
    <div x-show="success" class="fixed inset-0 z-[100] flex items-center justify-center bg-void p-6" x-cloak x-transition>
        <div class="text-center animate-fadeIn">
            <div class="w-24 h-24 bg-green-500/10 text-green-500 rounded-full flex items-center justify-center mx-auto mb-8">
                <i class="fa-solid fa-check text-4xl"></i>
            </div>
            <h2 class="text-white font-heading text-6xl mb-4 uppercase tracking-tighter">Bienvenue</h2>
            <p class="text-gray-400 text-xl max-w-md mx-auto mb-10 font-light">Votre accès au Board Vox Mastery a été activé. Consultez vos emails.</p>
            <button @click="window.location.href='/'" class="px-12 py-4 bg-white text-void font-bold uppercase text-xs tracking-widest hover:bg-neon transition-all">Accéder à mon espace</button>
        </div>
    </div>

    <script>
        function paymentSystem() {
            return {
                email: '',
                gateway: 'fedapay',
                loading: false,
                success: false,
                amount: 850000,
                WEBHOOK_MAKE: 'https://hook.eu1.make.com/q50cvrq1636zcg3xanqada7serxs6h15',
                
                init() {
                    // 1. On récupère l'email dans l'adresse de la page
                    const urlParams = new URLSearchParams(window.location.search);
                    const emailParam = urlParams.get('email');
                
                    if (emailParam) {
                        this.email = emailParam;
                    } else {
                        // 2. SÉCURITÉ : Si pas de mail, on bloque ou on avertit
                        alert("Erreur d'identification. Veuillez utiliser le lien reçu par e-mail pour finaliser votre inscription.");
                        // Optionnel : redirection vers l'accueil
                        // window.location.href = 'index.html'; 
                    }
                    
                    this.setupPayPal();
                },

                payWithFeda() {
                    this.loading = true;
                    FedaPay.init({
                        public_key: 'pk_live_7lvC3MGGdjrdWEXaRP1Dm3QD',
                        transaction: {
                            amount: this.amount,
                            description: 'Vox Mastery Executive 2026',
                            customer: { email: this.email }
                        },
                        onComplete: (res) => {
                            if(res.status === 'approved' || res.status.name === 'approved') {
                                this.handleFinalSuccess(res.id);
                            } else {
                                this.loading = false;
                            }
                        }
                    }).open();
                },

                setupPayPal() {
                    if(!window.paypal) return;
                    paypal.Buttons({
                        style: { layout: 'vertical', color: 'blue', shape: 'rect', label: 'pay' },
                        createOrder: (data, actions) => {
                            return actions.order.create({
                                purchase_units: [{
                                    amount: { currency_code: 'USD', value: '1415.00' }
                                }]
                            });
                        },
                        onApprove: (data, actions) => {
                            return actions.order.capture().then((details) => {
                                this.handleFinalSuccess(details.id);
                            });
                        }
                    }).render('#paypal-button-container');
                },

                async handleFinalSuccess(trxId) {
                    this.loading = true;
                    try {
                        await fetch(this.WEBHOOK_MAKE, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                email: this.email,
                                transactionId: trxId,
                                gateway: this.gateway,
                                status: 'PAID'
                            })
                        });
                        this.success = true;
                    } catch (e) {
                        alert("Erreur de synchronisation CRM. Notez l'ID : " + trxId);
                    } finally {
                        this.loading = false;
                    }
                }
            }
        }
    </script>
</body>
</html>
